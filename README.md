## FlyFun Apps & Tools

A collection of apps, web services, and command line tools built around the FlyFun Euro AIP dataset. Each project consumes the shared `airports.db` SQLite database generated by the `rzflight`/`euro_aip` tooling and presents the information in different contexts—iOS/macOS, web, ForeFlight content packs, and LLM integrations.

## Highlights

- **Shared aviation dataset** – Uses the `euro_aip` models from the [rzflight](https://github.com/roznet/rzflight) project to normalize European AIP data, runway details, and border crossing requirements.
- **Multiple frontends** – SwiftUI client for iOS/macOS, Leaflet + FastAPI web explorer, and an MCP server that exposes the data to LLMs.
- **Pilot-focused exports** – Command line utilities generate ForeFlight content packs, KML overlays, and other artifacts for flight planning.
- **Extensible workflows** – Examples and scripts illustrate how to slice the dataset, run analytics, or integrate with custom automation.

## Repository Layout

| Path | Description |
| --- | --- |
| `app/FlyFunEuroAIP/` | SwiftUI app that visualizes airports, procedures, and border crossings using `RZFlight`. |
| `web/` | FastAPI backend plus vanilla JS frontend with interactive maps, charts, and filters. |
| `mcp_server/` | FastMCP-based server that exposes airport search, route planning, and rules lookup tools to ChatGPT/Claude. |
| `tools/` | Python CLI utilities for exporting ForeFlight packs, building KML files, and working with AIP changes. |
| `python/` | Data engineering scripts to build and enrich `airports.db` from public sources and cached AIP material. |
| `examples/` | Small scripts showing how to consume the dataset in downstream workflows. |
| `data/` | Sample SQLite databases, Excel sheets, and cache snapshots used by the tools. |

## Data Flow

```
raw AIP files + OurAirports CSVs
            │
            ├─ python/airports.py  →  base runway + airport tables
            ├─ tools/aip*.py       →  normalized AIP cache
            └─ euro_aip models     →  airports.db (primary artifact)
                                           │
                 ┌─────────────────────────┼─────────────────────────┐
                 │                         │                         │
        SwiftUI app                FastAPI web API          CLI / MCP / Exports
```

`airports.db` lives in `web/server/` for convenience, but any component can load it via the environment variable `AIRPORTS_DB`.

## Environment Configuration

- Copy the provided sample environment files to your local configuration before running any service:
  - `web/server/dev.env.sample`
  - `web/server/security_config.py.sample`
  - `mcp_server/dev.env.sample`
  - `tools/dev.env.sample`
- Edit each copied file so the absolute paths (e.g., `AIRPORTS_DB`, content pack destinations, API keys) match your machine.
- The files are standard shell scripts—`source` them in your terminal session (or load the variables in your process manager) so the apps and tools pick up the correct configuration:

```bash
cp web/server/dev.env.sample web/server/dev.env
cp web/server/security_config.py.sample web/server/security_config.py
cp mcp_server/dev.env.sample mcp_server/dev.env
cp tools/dev.env.sample tools/dev.env
# edit the files, then
source web/server/dev.env   # or source mcp_server/dev.env, tools/dev.env as needed
```

Use separate copies (such as `prod.env`) when deploying to other environments.

## Getting Started

### 1. Clone and install core dependencies

```bash
git clone https://github.com/<your-org>/flyfun-apps.git
cd flyfun-apps
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
pip install -e git+https://github.com/roznet/rzflight@main#egg=euro_aip&subdirectory=euro_aip
```

### 2. Build or refresh the dataset

```bash
python python/airports.py create --database data/airports.db --cache python/cache
python tools/aip.py sync      # fetch and normalize Eurocontrol AIP pages
python tools/aipexport.py build --database data/airports.db
```

Copy or symlink the resulting `airports.db` into the components you plan to run.

### 3. Run the web explorer

```bash
export AIRPORTS_DB=/absolute/path/to/airports.db
cd web/server
cp dev.env.sample dev.env        # one-time setup
${EDITOR:-vi} dev.env            # set AIRPORTS_DB, secrets, etc.
source dev.env                   # loads variables into current shell
cp security_config.py.sample security_config.py  # configure auth rules
${EDITOR:-vi} security_config.py
uvicorn main:app --reload
# open http://localhost:8000 for the API, http://localhost:8000/static/ for the UI
```

### 4. Launch the MCP server

```bash
export AIRPORTS_DB=/absolute/path/to/airports.db
cd mcp_server
cp dev.env.sample dev.env        # one-time setup
${EDITOR:-vi} dev.env
source dev.env
python main.py
```

Add the server to ChatGPT or Claude via their MCP configuration using the bundled `mcp-flyfun.json` template.

### 5. Build the SwiftUI app

Open `app/FlyFunEuroAIP/FlyFunEuroAIP.xcodeproj` in Xcode. Ensure the bundled `Assets.xcassets` contains the latest `airports.db` (copy via the “Development Assets” folder if you need a small build for previews).

### 6. Export ForeFlight packs

```bash
cd tools
cp dev.env.sample dev.env        # one-time setup
${EDITOR:-vi} dev.env
source dev.env
python foreflight.py PointOfEntry -c airports --database /absolute/path/to/airports.db
python foreflight.py CustomApproach -c approach -x path/to/approaches.xlsx
```

## Examples & Automation

- `examples/` shows how to query the dataset, merge duplicate sources, and validate standardized fields.
- `tools/bordercrossingexport.py` and `tools/aipchange.py` provide ready-made scripts to highlight regulatory changes between AIRAC cycles.
- `python/weather/` includes utilities for storing METAR/TAF data alongside the airport information.

## Contributions & Support

Pull requests and issues are welcome—please include reproducible steps when reporting data discrepancies. The project is released under the MIT License (see `LICENSE`). For questions, open a GitHub issue or reach out via flyfun.aero.

Happy flying! ✈️

